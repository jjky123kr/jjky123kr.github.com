---
layout: post
title: Spring 게시판+ 검색기능 + 댓글기능
category: Backend
tags: Springe
---

#  Spring 게시판 및 검색기능 과 댓글 구현

###  SQL문 검색
* 검색을 할때 like 연산자 와 % %의 와일드 카드 
select* from emp where search like %keyword%

### 프로젝트 환경설정 

### pom.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.ch</groupId>
	<artifactId>board1</artifactId> 
	<name>board1</name>
	<packaging>war</packaging>
	<version>1.0.0-BUILD-SNAPSHOT</version>
	<properties>
		<java-version>1.8</java-version>
		<org.springframework-version>4.3.6.RELEASE</org.springframework-version>
		<org.aspectj-version>1.6.10</org.aspectj-version>
		<org.slf4j-version>1.6.6</org.slf4j-version>
	</properties>
	<repositories>
		<repository>
			<id>codelds</id>
			<url>https://code.lds.org/nexus/content/groups/main-repo</url>
		</repository>
	</repositories>
	<dependencies>
	
		<!-- JDK11 추가 -->
		<dependency>
			<groupId>javax.xml.bind</groupId>
			<artifactId>jaxb-api</artifactId>
			<version>2.3.1</version>
		</dependency>
		<dependency>
			<groupId>com.sun.xml.bind</groupId>
			<artifactId>jaxb-core</artifactId>
			<version>2.3.0.1</version>
		</dependency>
		<dependency>
			<groupId>com.sun.xml.bind</groupId>
			<artifactId>jaxb-impl</artifactId>
			<version>2.3.1</version>
		</dependency>
	
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-orm</artifactId>
			<version>${org.springframework-version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-test</artifactId>
			<version>${org.springframework-version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jdbc</artifactId>
			<version>${org.springframework-version}</version>
		</dependency>
		<dependency>
			<groupId>org.hibernate</groupId>
			<artifactId>hibernate-validator</artifactId>
			<version>5.1.3.Final</version>
		</dependency>
		<dependency> 
			<groupId>org.springframework</groupId> 
			<artifactId>spring-websocket</artifactId> 
			<version>${org.springframework-version}</version> 
		</dependency>		
		
		<!-- oracle -->
		<dependency>
			<groupId>com.oracle</groupId>
			<artifactId>ojdbc6</artifactId>
			<version>11.2.0.3</version>
			<scope>compile</scope>
		</dependency>
		<!-- dbcp jdbc connection pool -->
		<dependency>
			<groupId>commons-dbcp</groupId>
			<artifactId>commons-dbcp</artifactId>
			<version>1.2.2</version>
		</dependency>
		<dependency>
			<groupId>c3p0</groupId>
			<artifactId>c3p0</artifactId>
			<version>0.9.1.2</version>
		</dependency>
		<!-- mybatis -->
		<dependency>
			<groupId>org.mybatis</groupId>
			<artifactId>mybatis</artifactId>
			<version>3.2.3</version>
		</dependency>
		<dependency>
			<groupId>org.mybatis</groupId>
			<artifactId>mybatis-spring</artifactId>
			<version>1.2.1</version>
		</dependency>
		<!-- ibatis -->
		<dependency>
			<groupId>org.apache.ibatis</groupId>
			<artifactId>ibatis-sqlmap</artifactId>
			<version>2.3.4.726</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-ibatis</artifactId>
			<version>2.0.8</version>
		</dependency>
		<!-- cglib ibatis-->
		<dependency>
			<groupId>cglib</groupId>
			<artifactId>cglib</artifactId>
			<version>2.2</version>
		</dependency>
		<!-- Spring -->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context</artifactId>
			<version>${org.springframework-version}</version>
			<exclusions>
				<!-- Exclude Commons Logging in favor of SLF4j -->
				<exclusion>
					<groupId>commons-logging</groupId>
					<artifactId>commons-logging</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-webmvc</artifactId>
			<version>${org.springframework-version}</version>
		</dependency>

		<!-- AspectJ -->
		<dependency>
			<groupId>org.aspectj</groupId>
			<artifactId>aspectjrt</artifactId>
			<version>${org.aspectj-version}</version>
		</dependency>
		<dependency>
			<groupId>org.aspectj</groupId>
			<artifactId>aspectjweaver</artifactId>
			<version>1.6.8</version>
		</dependency>

		<!-- Logging -->
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-api</artifactId>
			<version>${org.slf4j-version}</version>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>jcl-over-slf4j</artifactId>
			<version>${org.slf4j-version}</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-log4j12</artifactId>
			<version>${org.slf4j-version}</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>log4j</groupId>
			<artifactId>log4j</artifactId>
			<version>1.2.15</version>
			<exclusions>
				<exclusion>
					<groupId>javax.mail</groupId>
					<artifactId>mail</artifactId>
				</exclusion>
				<exclusion>
					<groupId>javax.jms</groupId>
					<artifactId>jms</artifactId>
				</exclusion>
				<exclusion>
					<groupId>com.sun.jdmk</groupId>
					<artifactId>jmxtools</artifactId>
				</exclusion>
				<exclusion>
					<groupId>com.sun.jmx</groupId>
					<artifactId>jmxri</artifactId>
				</exclusion>
			</exclusions>
			<scope>runtime</scope>
		</dependency>

		<!-- @Inject -->
		<dependency>
			<groupId>javax.inject</groupId>
			<artifactId>javax.inject</artifactId>
			<version>1</version>
		</dependency>

		<!-- Servlet -->
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>servlet-api</artifactId>
			<version>2.5</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>javax.servlet.jsp</groupId>
			<artifactId>jsp-api</artifactId>
			<version>2.1</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>jstl</artifactId>
			<version>1.2</version>
		</dependency>
		<!-- Test -->
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>4.7</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>commons-fileupload</groupId>
			<artifactId>commons-fileupload</artifactId>
			<version>1.2</version>
		</dependency>

		<!-- Spring Security -->
		<dependency>
			<groupId>org.springframework.security</groupId>
			<artifactId>spring-security-core</artifactId>
			<version>3.2.4.RELEASE</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.security</groupId>
			<artifactId>spring-security-web</artifactId>
			<version>3.2.4.RELEASE</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.security</groupId>
			<artifactId>spring-security-config</artifactId>
			<version>3.2.4.RELEASE</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.security</groupId>
			<artifactId>spring-security-taglibs</artifactId>
			<version>3.1.4.RELEASE</version>
		</dependency>
		<dependency>
			<groupId>commons-io</groupId>
			<artifactId>commons-io</artifactId>
			<version>1.3.2</version>
		</dependency>

		<dependency>
			<groupId>org.scala-lang</groupId>
			<artifactId>scala-library</artifactId>
			<version>2.10.4</version>
		</dependency>
		<!-- javax.mail-->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context-support</artifactId>
			<version>4.1.3.RELEASE</version>
		</dependency>
		<dependency>
			<groupId>javax.mail</groupId>
			<artifactId>mail</artifactId>
			<version>1.4.7</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>${java-version}</source>
					<target>${java-version}</target>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-war-plugin</artifactId>
				<configuration>
					<warName>abc</warName>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-dependency-plugin</artifactId>
				<executions>
					<execution>
						<id>install</id>
						<phase>install</phase>
						<goals>
							<goal>sources</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<version>2.5</version>
				<configuration>
					<encoding>UTF-8</encoding>
				</configuration>
			</plugin>
		</plugins>
	</build>
</project>
```
## web.xml
```jsp
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">
	
	<!-- 한글 입력 -->
	<filter>
		<filter-name>CharacterEncodingFilter</filter-name>
		<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
		<init-param>
			<param-name>encoding</param-name>
			<param-value>UTF-8</param-value>
		</init-param>
		<init-param>
			<param-name>forceEncoding</param-name>
			<param-value>true</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>CharacterEncodingFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	
	<!-- The definition of the Root Spring Container shared by all Servlets and Filters -->
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>/WEB-INF/spring/root-context.xml</param-value>
	</context-param>
	
	<!-- Creates the Spring Container shared by all Servlets and Filters -->
	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>
	
	<!-- Processes application requests -->
	<servlet>
		<servlet-name>appServlet</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>/WEB-INF/spring/appServlet/servlet-context.xml</param-value>
		</init-param>
		<load-on-startup>1</load-on-startup>
	</servlet>		
	<servlet-mapping>
		<servlet-name>appServlet</servlet-name>
		<url-pattern>*.do</url-pattern>
	</servlet-mapping>
</web-app>
```

### servlet-context.xml(spring 환경설정)
1. base-package="board1" 

```jsp
<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/mvc"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
	
	<!-- DispatcherServlet Context: defines this servlet's request-processing infrastructure -->
	<!-- Enables the Spring MVC @Controller programming model -->
	<annotation-driven />
	
	<!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources directory -->
	<resources mapping="/resources/**" location="/resources/" />
	
	<!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
	<beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<beans:property name="prefix" value="/WEB-INF/views/" />
		<beans:property name="suffix" value=".jsp" />
	</beans:bean>	
	
	<context:component-scan base-package="board1" />	
	
</beans:beans>
```
### configuration.xml(mabtis 환경설정)

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
	<typeAliases>
		<typeAlias alias="board" type="board1.model.Board" />
	</typeAliases>
	<!-- <mappers>
		<mapper resource="Board.xml" />
	</mappers> -->
</configuration>
```
**jdbc.properties**
```jss
jdbc.driverClassName=oracle.jdbc.driver.OracleDriver
jdbc.url=jdbc:oracle:thin:@127.0.0.1:1521:xe
jdbc.username=spring
jdbc.password=spring123
jdbc.maxPoolSize=20
```
**root-context.xml(DB)** 

```jsp
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.1.xsd">
	
	<context:property-placeholder location="classpath:jdbc.properties" />
	
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="driverClass" value="${jdbc.driverClassName}" />
		<property name="jdbcUrl" value="${jdbc.url}" />
		<property name="user" value="${jdbc.username}" />
		<property name="password" value="${jdbc.password}" />
		<property name="maxPoolSize" value="${jdbc.maxPoolSize}" />
	</bean>
	
	<!-- 스프링 jdbc 즉 스프링으로 oracle 디비 연결 -->
	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" /> //DB 연결
		<property name="configLocation" value="classpath:configuration.xml" /> //mybatis 환경설정
		<property name="mapperLocations" value="classpath:sql/*.xml" />
	</bean>
	// 생성자 매개 변수로 DI
	<bean id="session" class="org.mybatis.spring.SqlSessionTemplate"> 
		<constructor-arg index="0" ref="sqlSessionFactory" /> // DAO의 SqlSessionTeplate 객체 사용가능
	</bean>

	<!-- SET default mail properties -->
	<bean id="jMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="host" value="smtp.naver.com" />
		<property name="port" value="465" />
		<property name="username" value="giduck23" />
		<property name="password" value="xxxxxxx" />
		<property value="smtps" name="protocol" />
		<property value="utf-8" name="defaultEncoding" />
		<property name="javaMailProperties">
			<props>
				<prop key="mail.smtp.auth">true</prop>
				<prop key="mail.smtp.starttls.enable">true</prop>
				<prop key="mail.smtps.ssl.checkserveridentity">true</prop>
				<prop key="mail.smtps.ssl.trust">*</prop>
				<!-- <prop key="mail.debug">true</prop> -->
			</props>
		</property>
	</bean>
	
</beans>
```
* 설정할때 가장 마지막으로 설정을 한다.
* DB 연동 할때 클래스 이다. 
* dataSource 의 클래스에 따라 property가 다르다. 
* DB와 연동 하는 클래스이다.   

### 테이블 생성

```sql
-- 게시판
select * from tab;
select * from board;

create table board (
	num number primary key, -- key
	writer varchar2(20) not null, -- 작성자
	subject varchar2(50) not null, -- 제목
	content varchar2(500) not null, -- 본문
	email varchar2(30) , -- 이메일
	readcount number default 0, -- 읽은 횟수
	passwd varchar2(12) not null, -- 암호
	ref number not null, -- 답변글끼리 그룹
	re_step number not null, -- ref내의 순서
	re_level number not null, -- 들여쓰기
	ip varchar2(20) not null, -- 작성자 ip
	reg_date date not null, -- 작성일
	del char(1) --
);
update board set readcount = 51 where num = 250;
```
* del char(1)의 역할은 회원이 탈퇴를 했을때 삭제가 아니라 y로 변경해서
  "삭제된 내용입니다" 출력한다. 
### model

**board.java(DTO)**

* 검색에 필요한 search, keyword 추가 한다. 
* page 자라주기 위한 starRow ,endRow 추가.

```java
package board1.model;

import java.sql.Date;

public class Board {
	private int num;
	private String writer;
	private String subject;
	private String content;
	private String email;
	private int readcount;
	private String passwd;
	private int ref;
	private int re_step;
	private int re_level;
	private String ip;
	private Date reg_date;
	private String del;

	// page
	private int startRow;
	private int endRow;
	
	// 검색
	private String search; // select name 값
	private String keyword; // 검색하는 양식의 name 값

	public String getSearch() {
		return search;
	}

	public void setSearch(String search) {
		this.search = search;
	}

	public String getKeyword() {
		return keyword;
	}

	public void setKeyword(String keyword) {
		this.keyword = keyword;
	}

	public int getStartRow() {
		return startRow;
	}

	public void setStartRow(int startRow) {
		this.startRow = startRow;
	}

	public int getEndRow() {
		return endRow;
	}

	public void setEndRow(int endRow) {
		this.endRow = endRow;
	}

	public int getNum() {
		return num;
	}

	public void setNum(int num) {
		this.num = num;
	}

	public String getWriter() {
		return writer;
	}

	public void setWriter(String writer) {
		this.writer = writer;
	}

	public String getSubject() {
		return subject;
	}

	public void setSubject(String subject) {
		this.subject = subject;
	}

	public String getContent() {
		return content;
	}

	public void setContent(String content) {
		this.content = content;
	}

	public String getEmail() {
		return email;
	}

	public void setEmail(String email) {
		this.email = email;
	}

	public int getReadcount() {
		return readcount;
	}

	public void setReadcount(int readcount) {
		this.readcount = readcount;
	}

	public String getPasswd() {
		return passwd;
	}

	public void setPasswd(String passwd) {
		this.passwd = passwd;
	}

	public int getRef() {
		return ref;
	}

	public void setRef(int ref) {
		this.ref = ref;
	}

	public int getRe_step() {
		return re_step;
	}

	public void setRe_step(int re_step) {
		this.re_step = re_step;
	}

	public int getRe_level() {
		return re_level;
	}

	public void setRe_level(int re_level) {
		this.re_level = re_level;
	}

	public String getIp() {
		return ip;
	}

	public void setIp(String ip) {
		this.ip = ip;
	}

	public Date getReg_date() {
		return reg_date;
	}

	public void setReg_date(Date reg_date) {
		this.reg_date = reg_date;
	}

	public String getDel() {
		return del;
	}

	public void setDel(String del) {
		this.del = del;
	}
}
```

### Controller
```java
package board1.controller;

import java.util.List;

import javax.mail.internet.MimeMessage;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import board1.model.Board;
import board1.model.Mail;
import board1.service.BoardService;
import board1.service.PagingPgm;

@Controller
public class BoardController {
	@Autowired
	private BoardService bs;
	@Autowired
	private JavaMailSender jMailSender;
	
	@RequestMapping(value="adminMail.do", method=RequestMethod.GET)
	public String adminMail() {
		return "adminMail";
	}
	
	@RequestMapping(value="adminMail.do", method=RequestMethod.POST)
	public String adminMailPost(Mail mail, Model model, HttpSession session) {
		MimeMessage mms = jMailSender.createMimeMessage();
		try {
			MimeMessageHelper messageHelper = new MimeMessageHelper(mms, true, "utf-8");
			messageHelper.setSubject(mail.getEmail());
			messageHelper.setText(mail.getContent(), true);
			messageHelper.setFrom("giduck23@naver.com");
			messageHelper.setTo(mail.getEmail());
			jMailSender.send(mms);
			model.addAttribute("message", "입력하신 이메일로 발송");
		} catch (Exception e) {
			System.out.println(e.getMessage());
			model.addAttribute("message", "메일 보내기 실패");
		}
		return "adminMailSent";
	}
	
  // 원문을 작성하고,list.do로 이동할때 page값을 가져오지 않았다. 
  // 검색을 하면 list.do 로 이동할때 page num 값을 가져온다. 
  // 검색을 했을때 sarch,keyword 전달되서, board에 저장을 한다. 
	@RequestMapping("list.do")	// 전체 목록, 검색 목록  구분하여 처리한다. 
	public String list(String pageNum, Board board, Model model) {  
		final int rowPerPage = 10;	// 화면에 출력할 데이터 갯수 
		if (pageNum == null || pageNum.equals("")) { 
			pageNum = "1";
		}
		int currentPage = Integer.parseInt(pageNum); // 현재 페이지 번호 
		
		// int total = bs.getTotal();
		int total = bs.getTotal(board); // 검색 , 전체 목록  (데이터 갯수)
		// 검색했을때 sarch와 keyword가 있어서 매개변수로 board 전달 
    // 전체 목록은(sarch , keyword)  가지고 있지 않다.                                   
		int startRow = (currentPage - 1) * rowPerPage + 1;
		int endRow = startRow + rowPerPage - 1;
		
		PagingPgm pp = new PagingPgm(total, rowPerPage, currentPage);
		board.setStartRow(startRow);      // DTO에 startRow 값 저장
        board.setEndRow(endRow);          // DTO에 endRow 값 저장
		// List<Board> list = bs.list(startRow, endRow);

		int no = total - startRow + 1;		  // 화면 출력 번호
		List<Board> list = bs.list(board);  // 검색된 글목록 + 전제 글 목록
		
		model.addAttribute("list", list);
		model.addAttribute("no", no);
		model.addAttribute("pp", pp);
		// 검색
		model.addAttribute("search", board.getSearch());
		model.addAttribute("keyword", board.getKeyword());
		
		return "list";
	}
// 원문 작성 할때 는 값을 가져 가지 않지만 댓글을 작성할때 값을 가져간다. 

	@RequestMapping("insertForm.do")	// 글작성 폼 (원문, 답변글)
	public String insertForm(String nm, String pageNum, Model model) { nm: 답글 변수
		int num = 0, ref = 0, re_level = 0, re_step = 0; // 원문
		if (nm != null) {	// 답변글   // 상세페이지view에서 답글 클릭시 넘어오는 변수 nm 
			num = Integer.parseInt(nm); // 부모글의 번호 
			Board board = bs.select(num);	// 부모글 정보 구해오기
			ref = board.getRef();            //부모글 ref 
			re_level = board.getRe_level();  //부모글의 level 
			re_step = board.getRe_step();    // 부모글의 step
		}
    // 값을 가져가는 것이 원문과 답글이 다르다. 
    // 답변 글의 가져가는 값
		model.addAttribute("num", num); // 번호
		model.addAttribute("ref", ref); // 원문
		model.addAttribute("re_level", re_level); 
		model.addAttribute("re_step", re_step); 
		model.addAttribute("pageNum", pageNum);
		
		return "insertForm";
	}
    // 원문을 처리와 답글을 처리하는 것을 구분해야 한다. 
    // 원문과 댓글이 양식이 같아서 seq를 사용을 불가한다. 
    // 최대값max 함수로 num을 최대 값을 구하여 1을 증가시켜준다.
    // 1증가한 값을 number 변수에 저장한다. 
    // else 가로가 없어서, 밑에 있는 하나만 실행된다. 
	@RequestMapping("insert.do")	// 글 작성
	public String insert(Board board, Model model, HttpServletRequest request) { // form에서 넘어온 값을 board(DTO)에 저장
		int num = board.getNum(); hidden 으로 넘어온num 값을 구한다. 
		int number = bs.getMaxNum(); //service 에 가서 max 값을 구한다. number 변수에 저장한다. 
		if (num != 0) {	 	// 답변글
			bs.updateRe(board); 
			board.setRe_level(board.getRe_level() + 1); 
			board.setRe_step(board.getRe_step() + 1);
		} else		     // 원문 : 원문과 댓글의 값은 같은 값 설정 "1"          
			board.setRef(number); // 최대값에 구한 1
			board.setNum(number); // 최대값을 구한 1 => 댓글과 원문 공통 
			String ip = request.getRemoteAddr(); ip 주소 
			board.setIp(ip);
			int result = bs.insert(board);// 원문과 댓글의 들어간 board의 값이 다르다.  
			model.addAttribute("result", result);
			
		return "insert"; 
	}

	@RequestMapping("view.do")	// 상세 페이지
	public String view(int num, String pageNum, Model model) { //num,pageNum 값 받는다. 
		bs.selectUpdate(num);	// 조회수 증가
		Board board = bs.select(num); // 상세 정보 구하기 
		model.addAttribute("board", board); // DTO ,pageNum 값을 가져간다. 
		model.addAttribute("pageNum", pageNum);
		
		return "view";
	}

	@RequestMapping("updateForm.do")	// 수정 폼
	public String updateForm(int num, String pageNum, Model model) { // num ,pageNum 
		Board board = bs.select(num); // 상세 정보
		model.addAttribute("board", board); 
		model.addAttribute("pageNum", pageNum);
		
		return "updateForm";
	}

	@RequestMapping("update.do")	// 수정
	public String update(Board board, String pageNum, Model model) { 
		int result = bs.update(board); // 상세정보 구하기 
		model.addAttribute("result", result); // 결과 전달 
		model.addAttribute("pageNum", pageNum); // pageNum 값을 전달 
		
		return "update"; 
	}

	@RequestMapping("deleteForm.do")// 삭제 폼
	public String deleteForm(int num, String pageNum, Model model) {
		Board board = bs.select(num);
		model.addAttribute("board", board);
		model.addAttribute("pageNum", pageNum);
		
		return "deleteForm";
	}

	@RequestMapping("delete.do") // 삭제 
	public String delete(int num, String pageNum, Model model) {
		int result = bs.delete(num);
		model.addAttribute("result", result);
		model.addAttribute("pageNum", pageNum);
		
		return "delete";
	}
}
```

### Service
```java
package board1.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import board1.dao.BoardDao;
import board1.model.Board;

@Service
public class BoardServiceImpl implements BoardService {
	@Autowired
	private BoardDao bd;
	글 목록
	// public List<Board> list(int startRow, int endRow) {
	public List<Board> list(Board board) {
		return bd.list(board);
	//	return bd.list(startRow, endRow);
	}
	// 총데이터 구하기 
	public int getTotal(Board board) {
		return bd.getTotal(board);
	}
	// insert(입력)
	public int insert(Board board) {
		return bd.insert(board);
	}
	// 상세정보 구하기
	public Board select(int num) {
		return bd.select(num);
	}
	// 조회수 증가 
	public void selectUpdate(int num) {
		bd.selectUpdate(num);
	}
	
	public int update(Board board) {
		return bd.update(board);
	}
	
	public int delete(int num) {
		return bd.delete(num);
	}
	// max
	public int getMaxNum() { 
		return bd.getMaxNum();
	}
	
	public void updateRe(Board board) {
		bd.updateRe(board);
	}
}
```


### dao

```java
package board1.dao;

import java.util.HashMap;
import java.util.List;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import board1.model.Board;

@Repository
public class BoardDaoImpl implements BoardDao {
	@Autowired
	private SqlSessionTemplate sst;
글 목록
	//	public List<Board> list(int startRow, int endRow) {
	public List<Board> list(Board board) {
/*		HashMap<String, Integer> hm=new HashMap<String, Integer>();
		hm.put("startRow",startRow);
		hm.put("endRow",endRow);*/
		return sst.selectList("boardns.list",board);
	}
// 총 데이터 구하기 	
	public int getTotal(Board board) {
		return sst.selectOne("boardns.getTotal",board);
	}
// insert(입력)	
	public int insert(Board board) {
		return sst.insert("boardns.insert",board);
	}
	// 상세 정보 구하기 
	public Board select(int num) {
		return sst.selectOne("boardns.select",num);
	}
	// 조회수 증가
	public void selectUpdate(int num) {
		sst.update("boardns.selectUpdate",num);
	}
	
	public int update(Board board) {
		return sst.update("boardns.update",board);
	}
	
	public int delete(int num) {
		return sst.update("boardns.delete",num);
	}
	//max 값 구하기 
	public int getMaxNum() {
		return sst.selectOne("boardns.getMaxNum");
	}
	
	public void updateRe(Board board) {
		sst.update("boardns.updateRe", board);
	}
	
}
```

### Board.xml(mapper)

* selet 검색을 할떄 id = getTotal 일때 동적SQL문을 사용.

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardns">
	<!-- Use type aliases to avoid typing the full classname every time. -->
	<resultMap id="boardResult"      type="board">
		<result property="num"	     column="num" />
		<result property="writer"    column="writer" />
		<result property="subject"   column="subject" />
		<result property="content"   column="content" />
		<result property="email"     column="email" />
		<result property="readcount" column="readcount" />
		<result property="passwd"    column="passwd" />
		<result property="ref"     	 column="ref" />
		<result property="re_step"	 column="re_step" />
		<result property="re_level"  column="re_level" />
		<result property="ip"  		 column="ip" />
		<result property="reg_date"	 column="reg_date" />
		<result property="del" 		 column="del" />
	</resultMap>
	
  <!-- 글 목록 : 검색 과 글목록 구분 하여 동적SQL 사용-->
	<!-- <select id="list" parameterType="hashMap" resultMap="boardResult"> -->
	<select id="list" parameterType="board" resultMap="boardResult"> 
		select * from (select a.*,rowNum rn from (  // 별칭 사용
			select * from board
		<where> // 조건절 입력
			<if test="keyword != null and search!='subcon'">
				${search} like '%'||#{keyword}||'%'  
			</if>
			<if test="keyword != null and search=='subcon'">
				subject like '%'||#{keyword}||'%' or
				content like '%'||#{keyword}||'%'
			</if>
		</where>			
			 order by ref desc,re_step) a )
			where rn between #{startRow} and #{endRow}  
	</select>
	<!--총데이터 구하기 : 검색 과 전체 목록을 구분하여 동적 SQL문으로 작성-->
	<select id="getTotal" parameterType="board" resultType="int">
		select count(*) from board 
		<where> // <where> 조건절: search와 keyword로 구분한다. 
			<if test="keyword != null and search !='subcon'"> 검색하지 않았을때 , 제목+내용으로 검색 X
				${search} like '%'||#{keyword}||'%'
// 변화있는 값은 $ 이때 ${}
			</if>
			<if test="keyword != null and search=='subcon'"> // 검색했을면, 제목+내용으로 검색
				subject like '%'||#{keyword}||'%' or
				content like '%'||#{keyword}||'%'
			</if>
		</where>
	</select>
	<!--상세정보 구하기 -->
	<select id="select" parameterType="int" resultType="board">
		select * from board where num=#{num}
	</select>
	
	<!-- num 번호중 최대값 구하기 : 첫번째 글은 1번으로  설정 -->
//  첫번째 글을 작성을 하면(num), null 값이다. 
//  num 값(null) 이라서 nvl 치환하여 값을 0으로 치환. 
	<select id="getMaxNum" resultType="int">
		select nvl(max(num),0) + 1 from board
	</select>

<!--insert 입력-->
	<insert id="insert" parameterType="board">
	<!--<selectKey keyProperty="num" 
			order="BEFORE" resultType="int">
			select nvl(max(num),0) + 1 from board
		</selectKey> -->
		insert into board values (#{num},#{writer},#{subject},
			#{content},#{email},0,#{passwd},#{ref},
			#{re_step},#{re_level},#{ip},sysdate,'n')
	</insert>
	<!--조회수 증가 -->
	<update id="selectUpdate" parameterType="int">
		update board set readcount = readcount+1 where num=#{num}
	</update>

	<update id="update" parameterType="board">
		update board set writer=#{writer},subject=#{subject},
			content=#{content},email=#{email} where num=#{num}
	</update>
	
  <!--삭제-->
	<update id="delete" parameterType="int">
		update board set del='y' where num=#{num} 
	</update> // 삭제는 y로 변경하여(update) 사용 
	<!--댓글 작성-->	
	<update id="updateRe" parameterType="board">
		update board set re_step = re_step + 1 // 부모과 원문이면 , 댓글 1을 증가 한다. 
		 where ref=#{ref} and re_step > #{re_step}  // 댓글이 원문이면, 댓글보다1 증가 공간 설정
	</update>
	
</mapper>
```
**PagingPgm.java(페이지 처리)**

* 전달된 기본변수를 생성자 매개변수로 초기화를 설정
* 파생변 변수를 생성한다. 

```java 
package board1.service;

public class PagingPgm {
	private int total;				// 데이터 갯수
	private int rowPerPage;			// 화면에 출력할 데이터 갯수
	private int pagePerBlk = 10;    // 블럭당 페이지 갯수 (1개의 블럭당 10개의 페이지)
	private int currentPage;		// 현재 페이지 번호
	private int startPage;			// 각 블럭의 시작 페이지
	private int endPage;            // 각 블럭의 끝 페이지
	private int totalPage;			// 총 페이지 수

	public PagingPgm(int total, int rowPerPage, int currentPage) { // 전달된 기본변수를 초기화
		this.total = total;
		this.rowPerPage = rowPerPage;
		this.currentPage = currentPage;
		
    // 파생된 변수 생성
		totalPage = (int) Math.ceil((double) total / rowPerPage);
		startPage = currentPage - (currentPage - 1) % pagePerBlk;	// 1,  11, 21...
		endPage = startPage + pagePerBlk - 1;						// 10, 20, 30...
		if (endPage > totalPage)
			endPage = totalPage;
	}

	public int getTotal() {
		return total;
	}

	public void setTotal(int total) {
		this.total = total;
	}

	public int getRowPerPage() {
		return rowPerPage;
	}

	public void setRowPerPage(int rowPerPage) {
		this.rowPerPage = rowPerPage;
	}

	public int getPagePerBlk() {
		return pagePerBlk;
	}

	public void setPagePerBlk(int pagePerBlk) {
		this.pagePerBlk = pagePerBlk;
	}

	public int getCurrentPage() {
		return currentPage;
	}

	public void setCurrentPage(int currentPage) {
		this.currentPage = currentPage;
	}

	public int getStartPage() {
		return startPage;
	}

	public void setStartPage(int startPage) {
		this.startPage = startPage;
	}

	public int getEndPage() {
		return endPage;
	}

	public void setEndPage(int endPage) {
		this.endPage = endPage;
	}

	public int getTotalPage() {
		return totalPage;
	}

	public void setTotalPage(int totalPage) {
		this.totalPage = totalPage;
	}
}
```

### view 
**insertForm.jsp(게시판 글 작성)**

* Controller클래스 에서 model 에 값을 가져온 것을 hidden으로 전달한다.

```java

	model.addAttribute("num", num); // 번호
		model.addAttribute("ref", ref); // 원문
		model.addAttribute("re_level", re_level); 
		model.addAttribute("re_step", re_step); 
		model.addAttribute("pageNum", pageNum);
```

```jsp

<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div class="container" align="center">
		<h2 class="text-primary">게시판 글쓰기</h2>
		<form action="insert.do" method="post">
			<input type="hidden" name="num" value="${num}"> 
			<input type="hidden" name="ref" value="${ref}"> 
			<input type="hidden" name="re_step" value="${re_step}"> 
			<input type="hidden" name="re_level" value="${re_level}"> 
			<input type="hidden" name="pageNum" value="${pageNum}">
			<table class="table table-striped">
				<tr>
					<td>제목</td>
					<td><input type="text" name="subject" required="required"></td>
				</tr>
				<tr>
					<td>작성자</td>
					<td><input type="text" name="writer" required="required"></td>
				</tr>
				<tr>
					<td>이메일</td>
					<td><input type="email" name="email" required="required"></td>
				</tr>
				<tr>
					<td>암호</td>
					<td><input type="password" name="passwd" required="required"></td>
				</tr>
				<tr>
					<td>내용</td>
					<td><textarea rows="5" cols="30" name="content"
							required="required"></textarea></td>
				</tr>
				<tr>
					<td colspan="2" align="center"><input type="submit" value="확인"></td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>
```
**insert.jsp(입력 메세지 )**

```jsp

<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<c:if test="${result > 0 }">
		<script type="text/javascript">
			alert("입력 성공");
			location.href = "list.do";
		</script>
	</c:if>
	<c:if test="${result <= 0 }">
		<script type="text/javascript">
			alert("입력 실패");
			history.go(-1);
		</script>
	</c:if>
</body>
</html>

```

```
<a href="list.do?pageNum=${pageNum}" class="btn btn-info">목록</a> 
```

**list.jsp( 전체 글목록)**

```jsp

<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div class="container" align="center">
		<h2 class="text-primary">게시판 목록</h2>
		<table class="table table-striped">
			<tr>
				<td>번호</td>
				<td>제목</td>
				<td>작성자</td>
				<td>작성일</td>
				<td>조회수</td>
			</tr>
			
			<c:if test="${empty list}">
				<tr>
					<td colspan="5">데이터가 없습니다</td>
				</tr>
			</c:if>
			
<c:if test="${not empty list}">
	<c:set var="no1" value="${no }"></c:set>
	 <c:forEach var="board" items="${list }">
			<tr>
				<td>${no1}</td>
	<c:if test="${board.del =='y' }">
		<td colspan="4">삭제된 데이터 입니다</td>
			</c:if>
				<c:if test="${board.del !='y' }">
				<td><a href="view.do?num=${board.num}&pageNum=${pp.currentPage}"
					 class="btn btn-default"> 
			<c:if test="${board.re_level >0 }">
				<img alt="" src="images/level.gif" height="2"
					width="${board.re_level *5 }">
				<img alt="" src="images/re.gif">
						</c:if> ${board.subject} 
						<c:if test="${board.readcount > 30 }">
							<img alt="" src="images/hot.gif">
								</c:if></a></td>
					<td>${board.writer}</td>
					<td>${board.reg_date}</td>
					<td>${board.readcount}</td>
						</c:if>
					</tr>
					<c:set var="no1" value="${no1 - 1}"/>
				</c:forEach>
			</c:if>
		</table>
		
		<form action="list.do">
			<input type="hidden" name="pageNum" value="1"> 
			<select	name="search">
				<option value="subject"	<c:if test="${search=='subject'}">selected="selected" </c:if>>제목</option>
				<option value="content"	<c:if test="${search=='content'}">selected="selected" </c:if>>내용</option>
				<option value="writer"	<c:if test="${search=='writer'}">selected="selected" </c:if>>작성자</option>
				<option value="subcon"	<c:if test="${search=='subcon'}">selected="selected" </c:if>>제목+내용</option>
			</select> 
			<input type="text" name="keyword"> 
			<input type="submit" value="확인">
		</form>
		
		<ul class="pagination">
			<!-- 검색 했을 경우의 페이징 처리 -->
			<c:if test="${not empty keyword}"> // 검색을 했을때 
				<c:if test="${pp.startPage > pp.pagePerBlk }">   
					<li><a
						href="list.do?pageNum=${pp.startPage - 1}&search=${search}&keyword=${keyword}">이전</a></li> // pageNum, search, keyword 값을 전달
				</c:if>
				<c:forEach var="i" begin="${pp.startPage}" end="${pp.endPage}">
					<li <c:if test="${pp.currentPage==i}">class="active"</c:if>><a
						href="list.do?pageNum=${i}&search=${search}&keyword=${keyword}">${i}</a></li>
				</c:forEach>
				<c:if test="${pp.endPage < pp.totalPage}">
					<li><a
						href="list.do?pageNum=${pp.endPage + 1}&search=${search}&keyword=${keyword}">다음</a></li>
				</c:if>
			</c:if>
			
			<!-- 전체 목록의 페이징 처리 -->
			<c:if test="${empty keyword}">  // 검색을 하지 않았을때 
				<c:if test="${pp.startPage > pp.pagePerBlk }"> // 시작 페이지 > 블럭당 페이지 갯수(10)
					<li><a href="list.do?pageNum=${pp.startPage - 1}">이전</a></li>
				</c:if> 
				<c:forEach var="i" begin="${pp.startPage}" end="${pp.endPage}">// 시작페이지, 마지막 페이지
					<li <c:if test="${pp.currentPage==i}">class="active"</c:if>> // 현재페이지가 i 일때 
						<a href="list.do?pageNum=${i}">${i}</a></li> // 현재 존제하는 페이지
				</c:forEach>
				<c:if test="${pp.endPage < pp.totalPage}"> // 마지막 페이지< 총페이지
					<li><a href="list.do?pageNum=${pp.endPage + 1}">다음</a></li>
				</c:if>
			</c:if>
		</ul>
		<div align="center">
			<a href="insertForm.do" class="btn btn-info">글 입력</a>
		</div>
	</div>
</body>
</html>
```

* list에서 전체 글 목록 과 검색하는 목록이 구분 하여 처리 
* 검색기능은 form 태그에서 list.do .이다
* 검색 기능에서 hidden 으로 pageNum 값 , search, keyword 값이 전달 된다. 
* list.do 에서 pageNum 변수에 저장한다. , search 와 keyword를 board에 저장한다.   
   검색옵션 select name=search , 검색 name = keyword 이다. 
* 이때 검색 했을떄 search , keyword가 값이 전달.

**view.jsp(상세페이지)**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	$(function() {
		$('#list').load('list.do?pageNum=${pageNum}');
	});
</script>
</head>
<body>
	<div class="container" align="center">
		<h2 class="text-primary">게시글 상세정보</h2>
		<table class="table table-bordered">
			<tr>
				<td>제목</td>
				<td>${board.subject}</td>
			</tr>
			<tr>
				<td>작성자</td>
				<td>${board.writer}</td>
			</tr>
			<tr>
				<td>조회수</td>
				<td>${board.readcount}</td>
			</tr>
			<tr>
				<td>아이피</td>
				<td>${board.ip}</td>
			</tr>
			<tr>
				<td>이메일</td>
				<td>${board.email}</td>
			</tr>
			<tr>
				<td>내용</td>
				<td><pre>${board.content}</pre></td>
			</tr>
		</table>
		
		<a href="list.do?pageNum=${pageNum}" class="btn btn-info">목록</a> 
		<a href="updateForm.do?num=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">수정</a> 
		<a href="deleteForm.do?num=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">삭제</a> 
		<a href="insertForm.do?nm=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">답변</a>
		<div id="list"></div>
	</div>
</body>
</html>
```
* pageNum , 번호 를 가져 간다. => 처음에 왔던 목록 페이지로 이동을 한다.
* 원문 과 댓글의 양식이 같다.  

> 원문 작성 할때는 아무런 값을 가져가지 않는다.  
  댓글은 nm 값, PageNum 값을 가져간다.   
  댓글을 작성할때 와 원문 양식이 같아서 구별을 위해서   
   controller 클래스에서 nm으로 변수로 설정한다.   


```
<a href="insertForm.do?nm=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">답변</a>
```

**insertForm.jsp(댓글 작성)**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div class="container" align="center">
		<h2 class="text-primary">게시판 글쓰기</h2>
		<form action="insert.do" method="post">
			<input type="hidden" name="num" value="${num}"> 
			<input type="hidden" name="ref" value="${ref}"> 
			<input type="hidden" name="re_step" value="${re_step}"> 
			<input type="hidden" name="re_level" value="${re_level}"> 
			<input type="hidden" name="pageNum" value="${pageNum}">
			<table class="table table-striped">
				<tr>
					<td>제목</td>
					<td><input type="text" name="subject" required="required"></td>
				</tr>
				<tr>
					<td>작성자</td>
					<td><input type="text" name="writer" required="required"></td>
				</tr>
				<tr>
					<td>이메일</td>
					<td><input type="email" name="email" required="required"></td>
				</tr>
				<tr>
					<td>암호</td>
					<td><input type="password" name="passwd" required="required"></td>
				</tr>
				<tr>
					<td>내용</td>
					<td><textarea rows="5" cols="30" name="content"
							required="required"></textarea></td>
				</tr>
				<tr>
					<td colspan="2" align="center"><input type="submit" value="확인"></td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>
```
**insert.jsp(입력 메세지 )**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<c:if test="${result > 0 }">
		<script type="text/javascript">
			alert("입력 성공");
			location.href = "list.do";
		</script>
	</c:if>
	<c:if test="${result <= 0 }">
		<script type="text/javascript">
			alert("입력 실패");
			history.go(-1);
		</script>
	</c:if>
</body>
</html>
```
```
<a href="updateForm.do?num=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">수정</a> 
```


**update.jsp(수정폼)**

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	function chk() {
		if(frm.passwd.value != frm.passwd2.value) {
			alert("암호가 다르면 수정할 수 없습니다");
			frm.passwd2.focus();
      frm.passwd2.value="";
			return false;
		}
	}
</script>
</head>
<body>
	<div class="container" align="center">
		<h2 class="text-primary">게시글 글수정</h2>
		<form action="update.do" method="post" name="frm"
			  onsubmit="return chk()">
			<input type="hidden" name="num" value="${board.num}"> // 비번을 비교를 위해서 where 조건절
			<input type="hidden" name="pageNum" value="${pageNum}">  // 다시 원래 페이지로 돌아간다
			<input type="hidden" name="passwd" value="${board.passwd}">// 비번 비교를 DTO의 비번 
			<table class="table table-striped">
				<tr>
					<td>번호</td>
					<td>${board.num}</td>
				</tr>
				<tr>
					<td>제목</td>
					<td><input type="text" name="subject" required="required"
								value="${board.subject}"></td>
				</tr>
				<tr>
					<td>작성자</td>
					<td><input type="text" name="writer" required="required"
								value="${board.writer}"></td>
				</tr>
				<tr>
					<td>이메일</td>
					<td><input type="email" name="email" required="required"
								value="${board.email}"></td>
				</tr>
				<tr>
					<td>암호</td> // name = passwd2 
 					<td><input type="password" name="passwd2" required="required"></td>
				</tr>
				<tr>
					<td>내용</td>
					<td>
						<textarea rows="5" cols="30" name="content" required="required">${board.content}
						</textarea>
					</td>
				</tr>
				<tr>
					<td colspan="2" align="center"><input type="submit" value="확인"></td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>
```
* hidden으로 num , pageNum, passwd 를 가져간다.
* 수정 폼 파일에서 비번을 비교
* form name 값 = frm , chk 함수 호출

frm(폼 객체 name).passwd(DTO비번 name).value(passwd 값)
frm(폼 객체 name).passwd2(사용자 입력 비번name).value(passwd의 값)
```jsp
<script type="text/javascript">
	function chk() { // 비번 비교
		if(frm.passwd.value != frm.passwd2.value) {
			alert("암호가 다르면 수정할 수 없습니다");
			frm.passwd2.focus();
			return false;
		}
	}
</script>
```
**update.jsp(수정)**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<c:if test="${result > 0 }">
		<script type="text/javascript">
			alert("수정 성공 ");
			location.href = "list.do?pageNum=${pageNum}";
		</script>
	</c:if>
	<c:if test="${result <= 0 }">
		<script type="text/javascript">
			alert("수정 실패");
			history.go(-1);
		</script>
	</c:if>
</body>
</html>
```

```
<a href="deleteForm.do?num=${board.num}&pageNum=${pageNum}"
		   class="btn btn-info">삭제</a> 
```
**deleteForm.jsp(삭제 폼)**
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="header.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	function chk() {
		if (frm.passwd.value != frm.passwd2.value) {
			alert("암호가 다릅니다. 수정후 작업하세요");
			frm.passwd2.focus();
      frm.passwd2.value="";
			return false;
		}
	}
</script>
</head>
<body>
	<div class="container">
		<h2 class="text-primary">게시글 삭제</h2>
		<form action="delete.do" name="frm" onsubmit="return chk()"	method="post">
			<input type="hidden" name="pageNum" value="${pageNum}"> // 현재페이지 정보
			<input	type="hidden" name="passwd" value="${board.passwd}"> // DTO의 비번 값
			<input type="hidden" name="num" value="${board.num}"> // 페이지 번호
			<table class="table">
				<tr>
					<td>암호</td> // name= passwd2 로 설정 사용자 비번
					<td><input type="password" name="passwd2" required="required"></td>
				</tr>
				<tr>
					<td colspan="2"><input type="submit" value="확인"></td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>
```
* 삭제 폼 에서 비번을 비교 한다. 
```jsp
<script type="text/javascript">
	function chk() {
		if (frm.passwd.value != frm.passwd2.value) {
			alert("암호가 다릅니다. 수정후 작업하세요");
			frm.passwd2.focus();
			return false;
		}
	}
</script>
```


