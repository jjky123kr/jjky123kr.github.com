---
layout: single
title : 게시판Modele2
folder: "MVC"
categories: 
      Spring
tags: [blog,Spring]

author_profile: true
sidebar:
  nav: "main"

toc: ture
toc_alble: 목록
toc_icon: "bars"
toc_sticky: true
---
### MVA 흐름
![웹 캡처_18-9-2022_15241_](https://user-images.githubusercontent.com/107549149/190888145-dc4fc3bb-8f71-4796-b024-92cebf544f5c.jpeg){: width="500" height="500"}

1. 클라언트의 요청으로 Serviet클래스로 찾아간다. 
> 찾아가는 방식은 WebSerivet 을 설정(*.do) => do확장자로 요청하는 요청을 받는다.
2. serviet클래스에서 service로 이동
> 요청파일의 service로 이동된다. 사용자의 요청을 처리하기 위한 기능을 제공
주로 DAO를 통해서 데이터에 접근하고 기능을 수행하는 데 필요한 로직을 구현
3. service 에서 DAO 이동
> DAO는 sql문 실행 => INSERT, SELECT, UPDATE, DELETE 쿼리를 실행해 주는 메소드를 제공한다.
4. DB에서 다시 DAO -> service 
> DB 에서 DAO로 가서 사용되고, DAO->service로 결과를 돌려준다. 
5. Service 에서 servlet 로 이동 
6. Servlet 에서 view 페이지 이동후 클라이언트 응답

### 주요기능
1. DB연동 :Connection Pool
2. 댓글 기능
3. 자료실 - 첨부파일 업로드, 다운로드: cos라이브러리 사용
4. request 객체 공유 설정
5. Controller 클래스:Java Servlet
6. Model= Service + DAO 
   Service,DTO,DAO클래스
7. View(화면 인터페이스):EL, JSTL

### 프로그램 구조

<img width="189" alt="파일구조" src="https://user-images.githubusercontent.com/107549149/192144536-0d83cd5e-e20b-4d24-9e64-318f2da754a5.png">

### 프로그램 주요 파일1
```
model2board- src- controller-BoardFrontController. java  
                   model-BoardBean.java(DTO)  
                   dao-BoardDAO.java(DAO)  
           service -  
                    -Action.java(부모인터페이스)  
                    -ActionForward.java (포워딩 설정)  
                    -BoardAddAction.java (글작성)  
                    -BoardListAction.java (글목록)  
                    -BoardDetailAction.java(글내용-상세 페이지)  
                    -BoardReplyAction.java(댓글폼)  
                    -BoardReply.java(댓글 작성)  
                    -BoardModifyAction.java(글수정폼)  
                    -BoardModify.java(글수정)  
                    -BoardDeleteAction.java(글삭제폼)  
                    -BoardDelete.java (글삭제)
```       
### 프로그램 주요 파일2

```
webapp - board -qna_board_write.jsp(글작성폼)
                qna_board_list.jsp(글 목록 출력)
                qna_board_view.jsp(글 내용출력)
                qna_board_reply.jsp(답변글폼)
                qna_board_modify.jsp(글수정폼)
                qna_board_delete.jsp(글삭제폼)
                file_down.jsp(다운로드)
          boardupload(첨부파일 저장위치)

          META-INF -contex.xml(컨넥션풀 환경설정 파일)
          WEB-INF-lib-jstl-1.2.jar
                       cos.jar
                       ojdbc.jar  
                      -web.xml(프로젝트의 환경설정 파일)   
```                



### 테이블 생성
```sql
select* from tab;
select*from seq;
select* from model2;

create table model2(
board_num number primary key,
board_name varchar2(20),
board_pass varchar2(15),
board_subject varchar2(50),
board_content varchar2(2000),
board_file varchar2(50),  -- 첨부 파일명
board_re_ref number,      -- 글 그룹번호 
board_re_lev number,      -- 댓글 깊이 : 원문(0), 1, 2...
board_re_seq number,      -- 댓글 출력 순서 : 원문(0) 오름차순 정렬
board_readcount number,
board_date timestamp );

create sequence model2_seq
start with 1
increment by 1
nocache;
```


### Cotroller 클래스

```java
package controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class BoardFrontController
 */
//("/")아무이름이나 요청을 받는다. 
@WebServlet("*.do")  //do확장자로 요청하는 요청을 받는다는 의미
public class BoardFrontController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	//doGet(),doPost()메소드에서 공통적인 작업을 처리하는 메소드
	protected void doProcess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		String requestURI = request.getRequestURI();
		String contextPath = request.getContextPath();
		String command = requestURI.substring(contextPath.length());
		
		System.out.println("requestURI:" + requestURI);  
		System.out.println("contextPath:" + contextPath);
		System.out.println("command:" + command);        
		
	}//doProcess()end
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		System.out.println("get");
	   doProcess(request,response); //doProcess()호출
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		System.out.println("post");		
	  doProcess(request,response); //doProcess()호출
	}

}
````
### qna_board_write.jsp (글작성 폼)
* action = 요청명과 동일 하다.
* post방식
*  파일 전송 enctype="multipart/form-data" 사용된다.

```jsp
<%@ page language="java" contentType="text/html; charset=utf-8"%>

<html>
<head>
	<title>MVC 게시판</title>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="<%=request.getContextPath() %>/board/script.js"></script>
</head>
<body>

<form action="<%=request.getContextPath() %>/BoardAddAction.do" method="post" 
	  enctype="multipart/form-data">
<table cellpadding="0" cellspacing="0" align=center border=1>
	<tr align="center" valign="middle">
		<td colspan="5">MVC 게시판</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">글쓴이</div>
		</td>
		<td>
			<input name="board_name" id="board_name" type="text" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">비밀번호</div>
		</td>
		<td>
			<input name="board_pass" id="board_pass" type="password" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">제 목</div>
		</td>
		<td>
			<input name="board_subject" id="board_subject" type="text" size="50" maxlength="100" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12">
			<div align="center">내 용</div>
		</td>
		<td>
			<textarea name="board_content" id="board_content" cols="67" rows="15"></textarea>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12">
			<div align="center">파일 첨부</div>
		</td>
		<td>
			<input name="board_file" type="file"/>
		</td>
	</tr>
	<tr bgcolor="cccccc">
		<td colspan="2" style="height:1px;">
		</td>
	</tr>
	<tr><td colspan="2">&nbsp;</td></tr>
	<tr align="center" valign="middle">
		<td colspan="5">			
			<input type=submit value="등록">
			<input type=reset value="취소">
		</td>
	</tr>
</table>
</form>

</body>
</html>
````
<img width="359" alt="게시판 양식" src="https://user-images.githubusercontent.com/107549149/192144609-bf331ed7-103d-4ef3-9e5f-5d906725d45c.png">

### 인터페이스 파일 생성 Action (부모)

```java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public interface Action {

	//추상 메소드 
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response)throws Exception;
	
}
````
### ActionForward .java (포워딩)

````java
package service;

public class ActionForward {
 
	private boolean redirect; //포워딩 방법 설정
	private String path;      // 포워딩 파일명 설정
	
	public boolean isRedirect() {
		return redirect;
	}
	public void setRedirect(boolean redirect) {
		this.redirect = redirect;
	}
	public String getPath() {
		return path;
	}
	public void setPath(String path) {
		this.path = path;
	}
	
}
````
### BoardAddAction.java( service 글작성)
* 첨부파일은 MultipartRequest 클래스로 객체를 생성해서 파일 업로드가 수행된다.
* 공유한 값을 받을 때 multi로 받는다. 

```java
BoardBean board = new BoardBean();
	 board.setBoard_name(multi.getParameter("board_name"));
	 board.setBoard_pass(multi.getParameter("board_pass"));
	 board.setBoard_subject(multi.getParameter("board_subject"));
	 board.setBoard_content(multi.getParameter("board_content"));
	 board.setBoard_file(multi.getFilesystemName("board_file"));
````

```java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.oreilly.servlet.MultipartRequest;
import com.oreilly.servlet.multipart.DefaultFileRenamePolicy;

import dao.BoardDAO;
import model.BoardBean;

public class BoardAddAction implements Action {

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardAddAction");
		
		
		String path = request.getRealPath("boardupload");
		System.out.println("path:"+path);
		
		int size = 1024*1024;
	// 첨부파일은 MultipartRequest 클래스로 객체를 생성하면서  파일 업로드가 수행된다.	
	 MultipartRequest multi = 
        new MultipartRequest(request, 
						        path,   // 업로드 디렉토리
						        size,   // 업로드 파일 크기(1MB)
						     "utf-8",   // 한글 인코딩
	    new DefaultFileRenamePolicy()); //중복파일 문제해결
	 
	 BoardBean board = new BoardBean();
	 board.setBoard_name(multi.getParameter("board_name"));
	 board.setBoard_pass(multi.getParameter("board_pass"));
	 board.setBoard_subject(multi.getParameter("board_subject"));
	 board.setBoard_content(multi.getParameter("board_content"));
	 board.setBoard_file(multi.getFilesystemName("board_file"));
	 
	 BoardDAO dao = BoardDAO.getInstance();
	 int result = dao.insert(board);  //원문 글 작성
	 if(result==1)System.out.println("글작성 성공");
	 
		
		ActionForward forward = new ActionForward();		
        forward.setRedirect(false);
        forward.setPath("/BoardListAction.do"); //목록을 불러오는 요청해야 한다. 
		return forward;
	}

}
````
### BoardFrontController.java (controller)

글작성(원문작성)
```java
  
		if(command.equals("/BoardAddAction.do")) {
			try {
				action = new BoardAddAction();
				forward = action.execute(request, response);
			}catch(Exception e) {
				e.printStackTrace();				
			}
````
### BoardDAO(DAO) 

```java
// 글작성 : 원문작성
public int insert(BoardBean board) {
	int result=0;
	
	Connection con = null;
	PreparedStatement pstmt = null;
	
	try {
		con = getConnection();
String sql="insert into model2 values(model2_seq.nextval,?,?,?,?,?,";
       sql+="model2_seq.nextval,?,?,?,sysdate)";
       pstmt= con.prepareStatement(sql);
       pstmt.setString(1, board.getBoard_name());
       pstmt.setString(2, board.getBoard_pass());
       pstmt.setString(3, board.getBoard_subject());
       pstmt.setString(4, board.getBoard_content());
       pstmt.setString(5, board.getBoard_file());
       pstmt.setInt(6, 0); //board_re_lev
       pstmt.setInt(7, 0); // board_re_seq
       pstmt.setInt(8, 0); // board_readcount       
      
       result = pstmt.executeUpdate(); //SQL문 실행
       
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		if(con != null)try {con.close();}catch(Exception e){}
		if(pstmt != null)try {pstmt.close();}catch(Exception e){}
	 }
	
	return result;
   }
`````
### BoardListAction.java (serivce 글목록)

* 공유되는 값이 설정 
>request.setAttribute
* 공유되는 값이 request라서 dispatch방식 으로 포워딩

```java
package service;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardListAction implements Action {

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardListAction");
		
		int page = 1;    // 현재 페이지 번호
		int limit = 10 ; // 한 페이지에 출력할 데이터 갯수
		
		if(request.getParameter("page")!=null) { // 페이지 번호값을 가져왔을때 
			page = Integer.parseInt(request.getParameter("page"));
		}
		
		// page=1: startRow = 1,  endRow=10
		// page=2: startRow = 11, endRow=20
		// page=3: startRow = 21, endRow=30
		int startRow = (page-1)*limit +1;
		int endRow = page* limit;
		
		BoardDAO dao = BoardDAO.getInstance();
		int listcount = dao.getcount(); // 총데이터 갯수 
		System.out.println("listcount:"+listcount);
		
		List<BoardBean> boardlist = dao.getList(startRow,endRow);
		System.out.println("boardlist:"+boardlist);
		
		// 총 페이지수
		int pageCount = listcount/limit +((listcount%limit==0)? 0:1);
		
		int startPage = ((page-1)/10)*limit +1; //1 ,11,21...
		int endPage = startPage +10 -1;         //10,20,30...
		
		if(endPage>pageCount)endPage = pageCount;
	    
		//공유설정 
		request.setAttribute("page",page );
		request.setAttribute("listcount",listcount );
		request.setAttribute("boardlist",boardlist );
		request.setAttribute("pageCount",pageCount );
		request.setAttribute("startPage",startPage );
		request.setAttribute("endPage",endPage );
		
		//request 객체로 공유한 경우에는 dispatcher 방식으로 포워딩 되어야,
		//view 페이지에서 공유한 값에 접근할 수 있다
		ActionForward forward = new ActionForward();	
	    forward.setRedirect(false); // dispatcher :방식으로 포워딩
	    forward.setPath("./board/qna_board_list.jsp");
		return forward;
	}

}
`````
### BoardFrontController.java (controller)
글작성 폼 ,글목록

```java	
//글작성 폼
		}else if(command.equals("/BoardForm.do")) {
			forward = new ActionForward();
			forward.setRedirect(false);
			forward.setPath("./board/qna_board_write.jsp");	
// 글목록 
		}else if(command.equals("/BoardListAction.do")){
			try {
				action = new BoardListAction();
				forward = action.execute(request, response);
			}catch(Exception e) {
				
			}
		
		}
````
### BoardDAO(DAO)

```java
// 총 데이터 갯수 구하기
public int getcount() {
	int result =0;
	
	Connection con = null;
	PreparedStatement pstmt = null;
	ResultSet rs = null;
	
	try {
		
		con = getConnection();
	String sql="select count(*) from model2";	
		pstmt = con.prepareStatement(sql);
		rs= pstmt.executeQuery(); //SQL문 실행
		
		if(rs.next()) {
		   //result =rs.getInt(1);
		    result = rs.getInt("count(*)");
		}
 		
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		if(con != null)try {con.close();}catch(Exception e){}
		if(pstmt != null)try {pstmt.close();}catch(Exception e){}
		if(rs != null)try {rs.close();}catch(Exception e){}
	}
	
	return result;
  }
// 글 목록: 데이터 10개 구하기 

public List<BoardBean> getList(int start ,int end){
	List<BoardBean> list = new ArrayList<BoardBean>();
	
	Connection con = null;
	PreparedStatement pstmt = null;
	ResultSet rs = null;
	
	try {
		 con = getConnection();
		 String sql="select * from ( select rownum rnum, board.* from ";
	       sql+=" (select * from model2 order by board_re_ref desc, ";
	       sql+=" board_re_seq asc) board ) ";
	       sql+=" where rnum >= ? and rnum <= ?";
		 pstmt = con.prepareStatement(sql);
		 pstmt.setInt(1, start);
		 pstmt.setInt(2, end);
		 rs = pstmt.executeQuery(); //SQL문 실행 
		 
		 while(rs.next()) {
			 BoardBean board = new BoardBean();
	     board.setBoard_num(rs.getInt("board_num"));
	     board.setBoard_name(rs.getString("board_name"));
	     board.setBoard_pass(rs.getString("board_pass"));
	     board.setBoard_subject(rs.getString("board_subject"));
	     board.setBoard_content(rs.getString("board_content"));
	     board.setBoard_file(rs.getString("board_file"));
	     board.setBoard_re_ref(rs.getInt("board_re_ref"));
	     board.setBoard_re_lev(rs.getInt("board_re_lev"));
	     board.setBoard_re_seq(rs.getInt("board_re_seq"));
	     board.setBoard_readcount(rs.getInt("board_readcount"));
	     board.setBoard_date(rs.getTimestamp("board_date"));
	     
	     list.add(board);
		 }
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		if(con != null)try {con.close();}catch(Exception e){}
		if(pstmt != null)try {pstmt.close();}catch(Exception e){}
		if(rs != null)try {rs.close();}catch(Exception e){}
	}
	
	
	return list;
}
````

### qna_board_list.jsp (글 목록 페이지)
* EL 표현언어 + JSTL 사용
* 국제화 라이브러리 frm => 날짜 시간 폼 
* 공유되는 값의 자료형이 다르면,View페이지에서 출력하는 방법이 다르다. 
1. 공유되는 값이 int 형 
>int 형과 String 형 은 바로 EL 표현언어${} 작성
2. 공유되는 값이 list 출력 방법
> forEach 태그의 items 값에 설정한다. 
3. 공유되는 값이 DTO 일때 출력 방법 
DTO 의 이름 값=board
> EL =${board.board_num}으로 사용된다. 

```
 <c:forEach var="b" items="${boardlist}"> 
```
* 댓글 제목 앞에 여백 처리 
>if태그와 forEach태그 사용

```

<c:if test="${b.board_re_lev >0}">
	 <c:forEach var="i" begin="0" end="${b.board_re_lev}">
   &nbsp;
   </c:forEach>
```

* EL에서는 증감 연산자가 지원되지 않는다. 
* set태그로 변수 정의

```
${num}<c:set var="num" value="${num-1}" />
```

````jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<a href="./BoardForm.do">글작성</a><br>
글갯수:${listcount}개<br> 

<%
int count =((Integer)request.getAttribute("listcount")).intValue(); 
%>
글갯수 : <%=count%>개<br>
	<table border="1" width="700" align="center">
		<tr>
			<td>번호</td>
			<td>제목</td>
			<td>작성자</td>
			<td>날짜</td>
			<td>조회수</td>
		</tr>
		<!-- 각 페이지에 출력될 시작 번호  -->
		<c:set var="num" value="${listcount-(page-1)*10}" />
		<c:forEach var="b" items="${boardlist}">
			<tr>
				<td>${num}<c:set var="num" value="${num-1}" />
				</td>
				<td>
					<!--댓글 제목 앞에 여백 처리  --> 
					<c:if test="${b.board_re_lev >0}">
					<c:forEach var="i" begin="0" end="${b.board_re_lev}">
                      &nbsp;
                    </c:forEach>
					</c:if> 
	   <a href="./BoardDetailAcion.do?board_num=${b.board_num}&page=${page}">				
					${b.board_subject}
	   </a>			
				</td>
				<td>${b.board_name}</td>
				<td><fmt:formatDate value="${b.board_date}"
						pattern="yyyy-MM-dd HH:mm:ss EEEE" /></td>
				<td>${b.board_readcount}</td>
			</tr>
		</c:forEach>
	</table><br><br>

<!--페이지처리-->
<center>
<c:if test="${listcount > 0 }">

<!-- 1page로 이동 -->
<a href="./BoardListAction.do?page=1" style="text-decoration:none"> << </a>

<!-- 이전 블럭으로 이동 -->
<c:if test="${startPage>10}">
<a href="./BoardListAction.do?page=${startPage-10}">[이전]</a>
</c:if>

<!-- 각 블럭에 10개의 페이지 출력 -->
<c:forEach var="i" begin="${startPage}" end="${endPage}">
	<c:if test="${i == page}">		<!-- 현재 페이지 -->
		[${i}]
	</c:if>
	<c:if test="${i != page}">		<!-- 현재 페이지가 아닌 경우 -->
		<a href="./BoardListAction.do?page=${i}">[${i}]</a>
	</c:if>
</c:forEach>

<!-- 다음 블럭으로 이동 -->
<c:if test="${endPage<pageCount}">
<a href="./BoardListAction.do?page=${startPage+10}">[다음]</a>
</c:if>

<!-- 마지막 페이지 이동 -->
<a href="./BoardListAction.do?page=${pageCount}"
  style="text-decoration:none"> >> </a>
</c:if>

</center>
</body>
</html>
````
<img width="632" alt="상세페이지" src="https://user-images.githubusercontent.com/107549149/192144675-68514fa9-feca-4ca9-9ddd-fc195adac750.png">

### BoardDetailAction.java( service 글 내용-상세페이지 )

`````java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardDetailAction implements Action {

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardDetailAction");
		
		int board_num = Integer.parseInt(request.getParameter("board_num"));
		String page = request.getParameter("page");
		
		BoardDAO dao = BoardDAO.getInstance();
		dao.readcountUpdate(board_num);             //조회수 증가
		BoardBean board = dao.getDetail(board_num); // 상세정보 구하기(수정,삭제도 가능하다.)
		
		// 글내용 줄바꿈 기능
		String content = board.getBoard_content().replace("\n", "<br>");
		
		//공유설정
		request.setAttribute("board",board);     // 상세 정보
		request.setAttribute("page",page);       // 글 내용 + 줄바꿈 
		request.setAttribute("content",content); // 페이지 값
		
		
		ActionForward forward = new ActionForward();
		forward .setRedirect(false);  //dispatcher 포워딩 방식
		forward.setPath("./board/qna_board_view.jsp");
		return forward;
	}

}
``````
### BoardFrontController (Controller)

상세페이지

```java

		}else if(command.equals("/BoardDetailAction.do")) {
		  try {
			  action = new BoardDetailAction();
			  forward = action.execute(request, response);
		  }catch(Exception e) {
			  e.printStackTrace();
		  }
		}
``````
### qna_board_view.jsp(글내용 출력)
*  댓글 클릭 할때  board_num 값 과, page 번호값 가져간다. 
* 목록을 클릭 했을때 목록페이지 이동할때 
page 값을 가져간다. 
* 공유된 값이 board = DTO  출력방식
>${board.board_num}

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<table border="1" width="500" align="center">

		<caption>상세페이지</caption>
		<tr>

			<td>제목</td>
			<td>${board.board_subject}</td>
		</tr>
		<tr>
			<td>내용</td>
			<td><pre>${board.board_content}</pre> 
			${content}
			</td>
		</tr>
         <tr>
           <td>첨부파일</td>
            <td>
         <!--첨부파일이 있을때 첨부파일 출력-->
         <c:if test="${board.board_file !=null}">
         <a href="./board/file_down.jsp?file_name=${board.board_file}">      
               ${board.board_file}
         </a>      
         </c:if>
            </td>
         </tr>
         <tr>
            <td colspan=2 align="center">
            <input type="button" value="댓글"
onClick="location.href='./BoardReplyAction.do?board_num=${board.board_num}&page=${page}'">
            
            <input type="button" value="수정">
            
            <input type="button" value="삭제">
            
            <input type="button" value="목록"
         onClick="location.href='./BoardListAction.do?page=${page}'">        
            </td>         
         </tr>
	</table>

</body>
</html>
````
<img width="375" alt="상세 페잊" src="https://user-images.githubusercontent.com/107549149/192144701-f666b287-9830-4663-a220-bf39d0d6a5e0.png">

### BoardReplyAction.java ( service 댓글 폼)
* 글내용 출력(qna_board_view.jsp)에서 넘어온 page 값과, board_num 값을 받는다.

````
int board_num= Integer.parseInt(request.getParameter("board_num"));
String page = request.getParameter("page");
`````
* 공유 설정 (boare_num , page)
```
 request.setAttribute("board", board);
 request.setAttribute("page", page);
`````

```java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardReplyAction implements Action{

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		
		System.out.println("BoardReplyAction");
		// board_num 값과 , page  값 받는다.
		int board_num= Integer.parseInt(request.getParameter("board_num"));
		String page = request.getParameter("page");
		
		BoardDAO dao = BoardDAO.getInstance();
		
		//부모글의 상세정보 구하기 
	    BoardBean board = dao.getDetail(board_num);
	    
	    //공유설정 (페이지, board(DTO)공유)
	    request.setAttribute("board", board);
	    request.setAttribute("page", page);
		
		ActionForward forward = new ActionForward();
		forward.setRedirect(false);
		forward.setPath("./board/qna_board_reply.jsp");
		
		
		return forward;
	}

}
````
### BoardForntController (controller )
댓글 폼
```java

else if(command.equals("/BoardReplyAction.do")) {
			try {
				action =new BoardReplyAction();
				forward =action.execute(request, response);
			}catch(Exception e) {
				e.printStackTrace();
			}
````
### qna_board_reply.jsp (댓글 폼)

* hidden으로 page , board_num, re_lev , re_ref ,re_sqf 설정한다. 

```jsp

<%@ page language="java" contentType="text/html; charset=utf-8"%>

<html>
<head>
	<title>댓글 게시판</title>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="<%=request.getContextPath() %>/board/script.js"></script>
</head>
<body>

<form action="<%=request.getContextPath() %>/BoardReply.do" method="post" >
<input type="hidden" name="board_num" value="${board.board_num}"> 
<input type="hidden" name="page" value="${page}"> 
<input type="hidden" name="board_re_ref" value="${board.board_re_ref}"> 
<input type="hidden" name="board_re_lev" value="${board.board_re_lev}"> 
<input type="hidden" name="board_re_seq" value="${board.board_re_seq}"> 
<table cellpadding="0" cellspacing="0" align=center border=1>
	<tr align="center" valign="middle">
		<td colspan="5">댓글 게시판</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">글쓴이</div>
		</td>
		<td>
			<input name="board_name" id="board_name" type="text" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">비밀번호</div>
		</td>
		<td>
			<input name="board_pass" id="board_pass" type="password" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">제 목</div>
		</td>
		<td>
			<input name="board_subject" id="board_subject" type="text" size="50" maxlength="100" 
				value="re."/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12">
			<div align="center">내 용</div>
		</td>
		<td>
			<textarea name="board_content" id="board_content" cols="67" rows="15"></textarea>
		</td>
	</tr>
	<tr bgcolor="cccccc">
		<td colspan="2" style="height:1px;">
		</td>
	</tr>
	<tr><td colspan="2">&nbsp;</td></tr>
	<tr align="center" valign="middle">
		<td colspan="5">			
			<input type=submit value="댓글">
			<input type=reset value="취소">
		</td>
	</tr>
</table>
</form>

</body>
</html>
````
<img width="361" alt="댓글 게시판" src="https://user-images.githubusercontent.com/107549149/192144741-20e0f01b-e0bc-4c73-bbe9-ab418b8195a9.png">

### BoardReply.java(serivce 댓글작성)
* 댓글 폼에서 hindden으로 넘어 온 값을 받는다.

```java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardReply implements Action{

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardReply");
		
		request.setCharacterEncoding("utf-8");
		
		//댓글 게시판 에서 hidden으로 넘어온 값
		int board_num = Integer.parseInt(request.getParameter("board_num"));
		int board_re_ref=Integer.parseInt(request.getParameter("board_re_ref"));
		int board_re_lev=Integer.parseInt(request.getParameter("board_re_lev"));
		int board_re_seq=Integer.parseInt(request.getParameter("board_re_seq"));
		String page = request.getParameter("page");
        
		// 사용자 입력한 값 
		BoardBean board = new BoardBean();
		board.setBoard_num(board_num);
		board.setBoard_re_ref(board_re_ref);
		board.setBoard_re_lev(board_re_lev);
		board.setBoard_re_seq(board_re_seq);
		board.setBoard_name(request.getParameter("board_name"));
		board.setBoard_pass(request.getParameter("board_pass"));
		board.setBoard_subject(request.getParameter("board_subject"));
		board.setBoard_content(request.getParameter("board_content"));
		
		BoardDAO dao = BoardDAO.getInstance();
		int result =dao.boardReply(board);
		if(result==1)System.out.println("댓글 작성 성공");
		
		ActionForward forward = new ActionForward();
		forward.setRedirect(true);
		forward.setPath("./BoardListAction.do?page="+page); //원래 진입했던 목록 페이지 이동
		return forward;
	}

}
````
### BoardFrontController(controller )
댓글작성
```java
}else if(command.equals("/BoardReply.do")) {
			try {
				action = new BoardReply();
				forward = action.execute(request, response);
			}catch(Exception e) {
				e.printStackTrace();
			}
````
### DAO(댓글작성)

```java
// 댓글 작성 
public int boardReply(BoardBean board) {
	int result =0;
	Connection con = null;
	PreparedStatement pstmt =null;
	
	// 부모글 에 대한 정보 
	int re_ref = board.getBoard_re_ref(); // 글 그룹 번호
	int re_lev = board.getBoard_re_lev(); // 댓글의 깊이
	int re_seq = board.getBoard_re_seq(); // 댓글의 출력순서
	
	try {
		con = getConnection();
       String sql="update model2 set board_re_seq=board_re_seq+1";
              sql+="where board_re_ref=? and board_re_seq > ?";
              
              pstmt =con.prepareStatement(sql);
              pstmt.setInt(1, re_ref);
              pstmt.setInt(2, re_seq);
              result = pstmt.executeUpdate();//SQL문 실행
		      
		      sql="insert into model2 values(model2_seq.nextval,";
		      sql+="?,?,?,?,?,?,?,?,?,sysdate)";

		      pstmt =con.prepareStatement(sql);
              pstmt.setString(1, board.getBoard_name());
              pstmt.setString(2, board.getBoard_pass());
              pstmt.setString(3, board.getBoard_subject());
              pstmt.setString(4, board.getBoard_content());
              pstmt.setString(5, "");   //boare_file
              pstmt.setInt(6, re_ref);  //board_re_ref
              pstmt.setInt(7, re_lev+1);//board_re_lev
              pstmt.setInt(8, re_seq+1);//board_re_seq
              pstmt.setInt(9, 0);       //board_readcount
              result = pstmt.executeUpdate();//SQL문 실행
              
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		if(con != null)try {con.close();}catch(Exception e){}
		if(pstmt != null)try {pstmt.close();}catch(Exception e){}
	}	
   	return result;
  }
}
````
### BoardModifyAction.java(service 수정폼 )
* page , num 값을 받는다. 

````java
package service;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardModifyAction implements Action{

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardModifyAction");
		
		int board_num = Integer.parseInt(request.getParameter("board_num"));
		String page = request.getParameter("page");
		
		BoardDAO dao = BoardDAO.getInstance();
		//상세 정보 구하기
		BoardBean board = dao.getDetail(board_num);
		
		//공유 설정
		request.setAttribute("board", board);
		request.setAttribute("page", page);
		
		ActionForward forward = new ActionForward();
		forward.setRedirect(false);   //dispatcher 방식으로 포워딩
		forward.setPath("./board/qna_board_modify.jsp");
		
		return forward;
	}

}
````
### BoardFrontController(controller)
수정폼

```java
}else if(command.equals("/BoardModifyAction.do")) {
			try {
				action = new BoardModifyAction();
				forward = action.execute(request, response);
			}catch(Exception e) {
				e.printStackTrace();
			}
````
### qna_board_modify.jsp(글 수정 폼)

```jsp

<%@ page language="java" contentType="text/html; charset=utf-8"%>

<html>
<head>
	<title>게시판 수정</title>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="<%=request.getContextPath() %>/board/script.js"></script>
</head>
<body>

<form action="<%=request.getContextPath() %>/BoardModify.do" method="post" >
<input type="hidden" name="board_num" value="${board.board_num}"> 
<input type="hidden" name="page" value="${page}"> 
<table cellpadding="0" cellspacing="0" align=center border=1>
	<tr align="center" valign="middle">
		<td colspan="5">게시판 수정</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">글쓴이</div>
		</td>
		<td>
			<input name="board_name" id="board_name" type="text" size="10" maxlength="10" 
				value="${board.board_name }"/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">비밀번호</div>
		</td>
		<td>
			<input name="board_pass" id="board_pass" type="password" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">제 목</div>
		</td>
		<td>
			<input name="board_subject" id="board_subject" type="text" size="50" maxlength="100" 
				value="${board.board_subject}"/>
		</td>
	</tr>
	<tr>
		<td style="font-family:돋음; font-size:12">
			<div align="center">내 용</div>
		</td>
		<td>
			<textarea name="board_content" id="board_content" cols="67" rows="15">${board.board_content}</textarea>
		</td>
	</tr>
	<tr bgcolor="cccccc">
		<td colspan="2" style="height:1px;">
		</td>
	</tr>
	<tr><td colspan="2">&nbsp;</td></tr>
	<tr align="center" valign="middle">
		<td colspan="5">			
			<input type=submit value="수정">
			<input type=reset value="취소">
		</td>
	</tr>
</table>
</form>

</body>
</html>
`````
<img width="355" alt="게시판 수정" src="https://user-images.githubusercontent.com/107549149/192144754-91a9b071-94f9-4693-931a-9afc329ffd27.png">

### BoardModify.java(service 글수정)

```java
package service;

import java.io.PrintWriter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardModify implements Action{

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardModify");
				
		response.setContentType("text/html; charset=utf-8");// 현재문서 인코딩
		request.setCharacterEncoding("utf-8");// 한글 인코딩
		
		PrintWriter out = response.getWriter(); //출력스트림
		
		int board_num=Integer.parseInt(request.getParameter("board_num"));
		String page = request.getParameter("page");
		String board_pass = request.getParameter("board_pass");// 사용자 입력 비번
		
		BoardBean board = new BoardBean();
		
		board.setBoard_num(board_num);
		board.setBoard_name(request.getParameter("board_name")); 
		board.setBoard_subject(request.getParameter("board_subject")); 
		board.setBoard_content(request.getParameter("board_content")); 
		
		BoardDAO dao = BoardDAO.getInstance();
		BoardBean old = dao.getDetail(board_num);// DTO 에 저장된 비번 구하기 
		
		//비번 비교
		if(old.getBoard_pass().equals(board_pass)) {  // 비번일치
			int result= dao.update(board);  // update SQL문실행
			if(result==1)System.out.println("글수정 성공");
      // 글수정 박스 메세지를 출력하는데 updateresult.jsp 페이지 (생성) 처리 해야 한다. 
      response.sendRedirect("./board/updateresult.jsp?page +page");// 페이지와 번호 값을 가져가야한다.   
          
		}else {                                      //비번 불일치
			  out.println("<script>");
			  out.println("alert('비번이 일치하지 않습니다.')");
			  out.println("history.go(-1);");
			  out.println("</script>");
			  out.close();
			  
			  return null; // 콘솔창에 에러메세지가 나타나지 않는다. 
		}
		
    // 글 수정 성공 메세지 박스 출력 할때 ActionForward 객체가 필요하지 않다. 
		//ActionForward forward = new ActionForward();
		//forward.setRedirect(false);
		//forward.setPath("/BoardListAction.do?page="+page);
	  //forward.setPath("/BoardDetailAction.do?board_num="+board_num+"&page="+page);//페이지 값 ,번호 값
		return null;
	}

}

````
### BoardFrontCotroller(controller)
글 수정
```java
// 글 수정
		}else if(command.equals("/BoardModify.do")) {
			try {
				action = new BoardModify();
				forward = action.execute(request, response);
			}catch(Exception e) {
				e.printStackTrace();
			}
		}
````
### DAO 글수정

````java
    // 글 수정 
  public int update(BoardBean board) {
	int result =0;
	Connection con = null;
	PreparedStatement pstmt = null;
	
	try {
		con = getConnection();
		String sql ="update model2 set board_name=?,board_subject=?,";
		       sql+="board_content=? where board_num=?";
		pstmt = con.prepareStatement(sql);
		pstmt.setString(1, board.getBoard_name());
		pstmt.setString(2, board.getBoard_subject());
		pstmt.setString(3, board.getBoard_content());
		pstmt.setInt(4, board.getBoard_num());
		
		result = pstmt.executeUpdate(); //SQL문 실행
		
	}catch(Exception e) {
		e.printStackTrace();
	}finally {
		if(con != null)try {con.close();}catch(Exception e){}
		if(pstmt != null)try {pstmt.close();}catch(Exception e){}
		
	}
	
	return result;
  }
````
### updateresult.jsp
* 넘어오는 값을 EL ${param.page}로 사용한다.
* 경로를 잘 찾기 위해서 <%=request.getContextPath()%> 사용

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<script>
   alert("글 수정 성공");
   location.href="<%=request.getContextPath()%>/BoardListAction.do?page="+${param.page};
</script>
````

### BoardFrontController.java
글 삭제 폼 

```java

		}else if(command.equals("/BoardDeleteAction.do")) { 
			forward = new ActionForward();
			forward.setRedirect(false);     //dispatcher
			forward.setPath("./board/qna_board_delete.jsp");
````
### qna_board_delete.jsp
* 공유한 값이 없어서 param으로 사용된다. 
> value = "${param.board_num}"을 사용한다. 

````
<input type="hidden" name="board_num" value="${param.board_num}"> 
<input type="hidden" name="page" value="${param.page}"> 
````

```jsp
<%@ page language="java" contentType="text/html; charset=utf-8"%>

<html>
<head>
	<title>게시판 삭제</title>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="<%=request.getContextPath() %>/board/script.js"></script>
</head>
<body>

board_num1:<%=request.getParameter("board_num") %><br>
page1:<%=request.getParameter("page") %><br>

board_num1 :${param.board_num}<br>
page2:${param.page}<br>



<form action="<%=request.getContextPath() %>/BoardDelete.do" method="post" >
<!--공유되는 값이 없어서, param 으로 값을 받는다. hidden의 value 값으로 설정   -->
<input type="hidden" name="board_num" value="${param.board_num}"> 
<input type="hidden" name="page" value="${param.page}"> 
<table cellpadding="0" cellspacing="0" align=center border=1>
	<tr align="center" valign="middle">
		<td colspan="5">게시판 삭제</td>
	</tr>
	
	<tr>
		<td style="font-family:돋음; font-size:12" height="16">
			<div align="center">비밀번호</div>
		</td>
		<td>
			<input name="board_pass" id="board_pass" type="password" size="10" maxlength="10" 
				value=""/>
		</td>
	</tr>
	
	</tr>
	<tr bgcolor="cccccc">
		<td colspan="2" style="height:1px;">
		</td>
	</tr>
	<tr><td colspan="2">&nbsp;</td></tr>
	<tr align="center" valign="middle">
		<td colspan="5">			
			<input type=submit value="삭제">
			<input type=reset value="취소">
		</td>
	</tr>
</table>
</form>

</body>
</html>
````
<img width="107" alt="삭제 폼" src="https://user-images.githubusercontent.com/107549149/192144788-b4e7ff61-3361-475a-bfcf-7512afc37df9.png">


### BoardDelete.java
* 비번을 비교해서, 삭제 한다. 
* 폴더 안에있는 이미지도 삭제 
>File file = new File(path);
* 폴더 안에 이미지를 불러올때 배열을 사용


```java
package service;

import java.io.File;
import java.io.PrintWriter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.BoardDAO;
import model.BoardBean;

public class BoardDelete implements Action{

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception {
		// TODO Auto-generated method stub
		System.out.println("BoardDelete");
		
		response.setContentType("text/html; charset=utf-8"); //현재문저 인코딩
		request.setCharacterEncoding("utf-8");// 넘어온 값 한글 인코딩
		
		PrintWriter out = response.getWriter();// 출력 스트림
		
		int board_num = Integer.parseInt(request.getParameter("board_num"));
		String page = request.getParameter("page");
		String board_pass = request.getParameter("board_pass");
		
		String path = request.getRealPath("boardupload"); //첨부파일 패스값
		System.out.println("path:"+path); 
		
		BoardDAO dao = BoardDAO.getInstance();
		BoardBean old = dao.getDetail(board_num); // 상세정보 구하기
		
		//비번 비교
		if(old.getBoard_pass().equals(board_pass)) {  //비번 일치
			int result=dao.delete(board_num);  //delete SQL문 실행
		    if(result ==1)System.out.println("글 삭제 성공");
			//첨부파일 있는 경우에 첨부파일을 삭제 
			if(old.getBoard_file() !=null) {
				File file = new File(path);
				file.mkdir();
				
				//boardupload 디렉토리의 모든 첨부 파일을 구해오기
				File [] f= file.listFiles();
				for(int i =0; i<f.length; i++) {
					if(f[i].getName().equals(old.getBoard_file())) {
						f[i].delete();   //첨부파일 삭제
					}
				}
			}
			
		}else {                                         //비번 불일치
			out.println("<script>");
			out.println("alert('비번이 일치하지 않습니다.')");
			out.println("history.go(-1)");
			out.println("</script>");
			out.close();
			
			return null; 
			
		}
			
		ActionForward forward = new ActionForward();
		forward.setRedirect(false);
		forward.setPath("/BoardListAction.do?page="+page);
		return forward;
	}

}
````
### DAO 삭제 

```java
// 글 삭제
  public int delete(int board_num) {
	  int result =0;
	  
	  Connection con = null;
	  PreparedStatement pstmt = null;
	  
	  try {
		  con = getConnection();
		  
		  String sql="delete from model2 where board_num=?";
		  
		  pstmt = con.prepareStatement(sql);
		  pstmt.setInt(1, board_num);		  
		  result = pstmt.executeUpdate();  //SQL문 실행
		  
		  
	  }catch(Exception e) {
		  e.printStackTrace();
	  }finally {
		  if(con != null)try {con.close();}catch(Exception e){}
		  if(pstmt != null)try {pstmt.close();}catch(Exception e){}
	  }
	  
````














